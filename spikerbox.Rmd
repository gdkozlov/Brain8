---
title: "brainbox"
author: '490414712'
date: "`r Sys.Date()`"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggplot2)
library(cvTools)
library(tuneR)
library(tsfeatures)
library(class)
library(matrixStats)
```
# reading in pre recorded data
```{r}
dir_length3 = 'zoe_spiker/Length3'
all_files_length3 <- list.files(dir_length3)
wave_file_length3 <- list()
wave_left_length3 <- list()
for (i in all_files_length3) {
  wave_file_length3[[i]] <- readWave(file.path(dir_length3, i))
  wave_left_length3[[i]] <- readWave(file.path(dir_length3, i))@left
}
length3_lab <- substr(all_files_length3, 1, 3)

dir_length8 = 'zoe_spiker/Length8'
all_files_length8 <- list.files(dir_length8)
wave_file_length8 <- list()
wave_left_length8 <- list()
for (i in all_files_length8) {
  wave_file_length8[[i]] <- readWave(file.path(dir_length8, i))
  wave_left_length8[[i]] <- readWave(file.path(dir_length8, i))@left
}
length8_lab <- substr(all_files_length8, 1, 8)

dir_long = 'zoe_spiker/long'
all_files_long <- list.files(dir_long)
wave_file_long <- list()
wave_left_long <- list()
for (i in all_files_long) {
  wave_file_long[[i]] <- readWave(file.path(dir_long, i))
  wave_left_long[[i]] <- readWave(file.path(dir_long, i))@left
}
long_lab <- substr(all_files_long, 1, 20)


```
# initial testing
```{r}
eye_movement_sd = function(Y, 
thresholdEvents = 1500) {
  testStat <- sd(Y)
return (ifelse(testStat > thresholdEvents, 'T', 'F'))
}

LR_detection = function(seq) {
maxval = which.max(seq)
minval = which.min(seq)
movement = ifelse(maxval < minval,  "L", "R")
return(movement)
}

streaming_classifier = function(wave_file,  
                                window_size = wave_file@samp.rate,
                                increment = window_size/10)
{
  Y = wave_file@left
  xtime = seq_len(length(wave_file@left))/wave_file@samp.rate 
  predicted_labels_sd = c()
  lower_interval = 1
  max_time = max(xtime)*window_size
  
  while(max_time > lower_interval + window_size)
  {
    is_event = 'F'
    upper_interval = lower_interval + window_size
    interval = Y[lower_interval:upper_interval]
    is_event = eye_movement_sd(Y = interval)
    if (is_event == 'T') {
      predicted_sd = LR_detection(interval)
      predicted_labels_sd = c(predicted_labels_sd, predicted_sd)
    }
    lower_interval = lower_interval + increment 
  }
  return (predicted_labels_sd)
}

results_sd = rep(NA, length(wave_file_length3))
for (i in 1:length(wave_file_length3)) {
  results_sd[i] <- streaming_classifier(wave_file_length3[[i]]) %>% paste(collapse="")
}

```

# experimenting with standard deviation
```{r}
vary_threshold_sd = function(Y, 
thresholdEvents) {
  testStat <- sd(Y)
return (ifelse(testStat > thresholdEvents, 'T', 'F'))
}

vary_threshold_classifier_sd = function(wave_file, events, 
                                window_size = wave_file@samp.rate,
                                increment = window_size/10)
{
  Y = wave_file@left
  xtime = seq_len(length(wave_file@left))/wave_file@samp.rate 
  predicted_labels_sd = c()
  predicted_times_sd = c()
  lower_interval = 1
  max_time = max(xtime)*window_size
  sd_values <- c()
  
  while(max_time > lower_interval + window_size)
  {
    is_event = 'F'
    upper_interval = lower_interval + window_size
    interval = Y[lower_interval:upper_interval]
    sd_values <- append(sd_values, sd(interval))
    is_event = vary_threshold_sd(Y = interval, thresholdEvents = events)
    if (is_event == 'T') {
      predicted_sd = LR_detection(interval)
      predicted_labels_sd = c(predicted_labels_sd, predicted_sd)
      predicted_times_sd = c(predicted_times_sd, lower_interval/10000)
    }
    lower_interval = lower_interval + increment 
  }
  return (list(predicted_labels_sd = predicted_labels_sd,
               predicted_times_sd = predicted_times_sd,
               sd_values = sd_values))
}

vary_threshold_classifier_sd(wave_file_length3[[1]], 869)$predicted_times_sd

vary_threshold_classifier_sd(wave_file_length3[[1]], 869)$sd_values %>% plot(., type = 'l', xlab = 'Window number', ylab = 'Standard deviation', main = 'Standard deviation of rolling window for LLL wave')
#3 events are detected when the threshold is in the range of 864-869


timeSeq <- seq_len(length(wave_file_length3[[1]]))/wave_file_length3[[1]]@samp.rate
plot(timeSeq, wave_file_length3[[1]]@left, type = 'l', main = 'Predicted events using standard deviation', xlab = 'Tim in seconds', ylab = 'Wave')
abline(v = vary_threshold_classifier_sd(wave_file_length3[[1]], 650)$predicted_times_sd)
vary_threshold_classifier_sd(wave_file_length3[[1]], 864)




vary_threshold_classifier(wave_file_length3[[2]], 799)
#799-821



```

# experimenting with zero crossings
```{r}
vary_threshold_zc = function(Y, 
thresholdEvents) {
  testStat <- sum(Y[1:(length(Y) - 1)] * Y[2:(length(Y))] <= 0)
return (ifelse(testStat < thresholdEvents, 'T', 'F'))
}

vary_threshold_classifier_zc = function(wave_file, events, 
                                window_size = wave_file@samp.rate,
                                increment = window_size/10)
{
  Y = wave_file@left
  xtime = seq_len(length(wave_file@left))/wave_file@samp.rate 
  predicted_labels_zc = c()
  predicted_times_zc = c()
  lower_interval = 1
  max_time = max(xtime)*window_size
  zc_values <- c()
  second_check = 'F'
  
  while(max_time > lower_interval + window_size)
  {
    is_event = 'F'
    upper_interval = lower_interval + window_size
    interval = Y[lower_interval:upper_interval]
    zc_values <- append(zc_values, sum(interval[1:(length(interval) - 1)] * interval[2:(length(interval))] <= 0))
    is_event = vary_threshold_zc(Y = interval, thresholdEvents = events)
    if (is_event == 'T') {
      if (second_check == 'F') {
        second_check = 'T'
      } else {
        predicted_zc = LR_detection(interval)
        predicted_labels_zc = c(predicted_labels_zc, predicted_zc)
        predicted_times_zc = c(predicted_times_zc, lower_interval/10000)
        second_check = 'F'
      }
    }
    lower_interval = lower_interval + increment 
  }
  return (list(predicted_labels_zc = predicted_labels_zc,
               predicted_times_zc = predicted_times_zc,
               zc_values = zc_values))
}

vary_threshold_classifier_zc(wave_file_length3[[2]], 20)$zc_values %>% plot(., type = 'l', xlab = 'Window number', ylab = 'Zero crossings', main = 'Zero crossings in rolling window for LLL wave')

plot(timeSeq, wave_file_length3[[1]]@left, type = 'l', main = 'Predicted events using zero crossings', xlab = 'Time in seconds', ylab = 'Wave')
abline(h = 0)
abline(v = vary_threshold_classifier_zc(wave_file_length3[[1]], 70)$predicted_times_zc)



vary_threshold_classifier_zc(wave_file_length3[[1]], )$predicted_values





vary_threshold_classifier_zc(wave_file_length3[[2]], 799)



```

# experimenting with amplitude spikes
```{r}
vary_threshold_amp = function(Y, 
thresholdEvents) {
  testStat <- abs(Y) %>% max
return (ifelse(testStat > thresholdEvents, 'T', 'F'))
}

vary_threshold_classifier_amp = function(wave_file, events, 
                                window_size = wave_file@samp.rate,
                                increment = window_size/10)
{
  Y = wave_file@left
  xtime = seq_len(length(wave_file@left))/wave_file@samp.rate 
  predicted_labels_amp = c()
  predicted_times_amp = c()
  lower_interval = 1
  max_time = max(xtime)*window_size
  amp_values <- c()
  end_event = 'F'
  
  while(max_time > lower_interval + window_size)
  {
    is_event = 'F'
    upper_interval = lower_interval + window_size
    interval = Y[lower_interval:upper_interval]
    amp_values <- append(amp_values, abs(interval) %>% max)
    is_event = vary_threshold_amp(Y = interval, thresholdEvents = events)
    if (is_event == 'T') {
      if (end_event == 'F') {
        end_event = 'T'
      } else {
        predicted_amp = LR_detection(interval)
        predicted_labels_amp = c(predicted_labels_amp, predicted_amp)
        predicted_times_amp = c(predicted_times_amp, lower_interval/10000)
        end_event = 'F'
      }
    }
    lower_interval = lower_interval + increment 
  }
  return (list(predicted_labels_amp = predicted_labels_amp,
               predicted_times_amp = predicted_times_amp,
               amp_values = amp_values))
}

vary_threshold_classifier_amp(wave_file_length3[[3]], 869)$amp_values %>% plot(x = ., type = 'l', xlab = 'Window number', ylab = 'Max amplitude', main = 'Max amplitude of rolling window for LLL wave')
vary_threshold_classifier_amp(wave_file_length3[[8]], 869)$amp_values %>% plot


plot(timeSeq, wave_file_length3[[1]]@left, type = 'l', main = 'Predicted events using max amplitude', xlab = 'Time in seconds', ylab = 'Wave')
abline(v = vary_threshold_classifier_amp(wave_file_length3[[1]], 2200)$predicted_times_amp)

plot()


plot(wave_file_length3[[5]]@left, type = 'l')
```


# AMPLITUDE SPIKES NUMBER 2
```{r}
vary_threshold_amp = function(Y, 
thresholdEvents) {
  testStat <- abs(Y) %>% max
return (ifelse(testStat > thresholdEvents, 'T', 'F'))
}

vary_threshold_classifier_amp = function(wave_file, events, 
                                window_size = wave_file@samp.rate,
                                increment = window_size/10)
{
  Y = wave_file@left
  xtime = seq_len(length(wave_file@left))/wave_file@samp.rate 
  predicted_labels_amp = c()
  predicted_times_amp = c()
  lower_interval = 1
  max_time = max(xtime)*window_size
  amp_values <- c()
  end_event = 'F'
  
  while(max_time > lower_interval + window_size)
  {
    is_event = 'F'
    upper_interval = lower_interval + window_size
    interval = Y[lower_interval:upper_interval]
    amp_values <- append(amp_values, abs(interval) %>% max)
    is_event = vary_threshold_amp(Y = interval, thresholdEvents = events)
    if (is_event == 'T') {
      if (end_event == 'F') {
        end_event = 'T'
      } else {
        predicted_amp = LR_detection(interval)
        predicted_labels_amp = c(predicted_labels_amp, predicted_amp)
        predicted_times_amp = c(predicted_times_amp, lower_interval/10000)
        end_event = 'F'
      }
    }
    lower_interval = lower_interval + increment 
  }
  return (list(predicted_labels_amp = predicted_labels_amp,
               predicted_times_amp = predicted_times_amp,
               amp_values = amp_values))
}

vary_threshold_classifier_amp(wave_file_length3[[4]], 869)$amp_values %>% plot(x = ., type = 'l', xlab = 'Window number', ylab = 'Max amplitude', main = 'Max amplitude of rolling window for LLL wave')
vary_threshold_classifier_amp(wave_file_length3[[8]], 869)$amp_values %>% plot


plot(timeSeq, wave_file_length3[[1]]@left, type = 'l', main = 'Predicted events using max amplitude', xlab = 'Time in seconds', ylab = 'Wave')
abline(v = vary_threshold_classifier_amp(wave_file_length3[[1]], 2200)$predicted_times_amp)

plot()


plot(wave_file_length3[[5]]@left, type = 'l')
```


# Classification by feature
```{r}
wave_seq_short = readRDS("wave_seq_short_list_zoe.rds")
wave_label_short = readRDS("wave_label_short_results.rds")
Y_list = unlist(wave_seq_short, recursive=FALSE)
Y_lab = unlist(wave_label_short)

Y_list = append(Y_list, new_blink)
Y_lab = append(Y_lab, blink_lab)

Y_features <- cbind(
  tsfeatures(Y_list,
             c("acf_features","entropy","lumpiness",
               "flat_spots","crossing_points")),
  tsfeatures(Y_list, "max_kl_shift", width=48),
  tsfeatures(Y_list,
             c("mean","var"), scale=FALSE, na.rm=TRUE),
  tsfeatures(Y_list,
             c("max_level_shift","max_var_shift"), trim=TRUE))

X = as.matrix(Y_features)
y = Y_lab 

cvK = 5  # number of CV folds
cv_50acc5_knn = cv_50acc5_svm = cv_50acc5_rf = c()
cv_acc_knn = cv_acc_svm = cv_acc_rf = c()
for (i in 1:50) {
  cvSets = cvTools::cvFolds(nrow(X), cvK)  # permute all the data, into 5 folds
  cv_acc_knn = cv_acc_svm = cv_acc_rf = c()
  for (j in 1:cvK) {
    test_id = cvSets$subsets[cvSets$which == j]
    X_test = X[test_id, ]
    X_train = X[-test_id, ]
    y_test = y[test_id]
    y_train = y[-test_id]
    
    ## KNN
    fit5 = class::knn(train = X_train, test = X_test, cl = y_train, k = 5)
    cv_acc_knn[j] = mean(fit5 == y_test)
    
    ## SVM
    svm_res <- e1071::svm(x = X_train, y = as.factor(y_train))
    fit <- predict(svm_res, X_test)
    cv_acc_svm[j] = mean(fit == y_test)

    ## RandomForest
    rf_res <- randomForest::randomForest(x = X_train, y = as.factor(y_train))
    fit <- predict(rf_res, X_test)
    cv_acc_rf[j] = mean(fit == y_test)
  }
  cv_50acc5_knn <- append(cv_50acc5_knn, mean(cv_acc_knn))
  cv_50acc5_svm <- append(cv_50acc5_svm, mean(cv_acc_svm))
  cv_50acc5_rf <- append(cv_50acc5_rf, mean(cv_acc_rf))
}

par(mfrow = c(1, 3))
boxplot(cv_50acc5_knn, horizontal = TRUE, main = 'Accuracy of KNN model')
boxplot(cv_50acc5_svm, horizontal = TRUE, main = 'Accuracy of SVM model')
boxplot(cv_50acc5_rf, horizontal = TRUE, main = 'Accuracy of random forest model')

boxplot(cv_50acc5_knn, cv_50acc5_svm, cv_50acc5_rf, horizontal = TRUE, names = c('KNN', 'SVM', 'RF'), main = 'Evaluating classifier performance', xlab = '% Accuracy using 5-fold cross validation')

wave = readWave('Record_L.wav')@left

features <- cbind(
  tsfeatures(wave,
             c("acf_features","entropy","lumpiness",
               "flat_spots","crossing_points")),
  tsfeatures(wave, "max_kl_shift", width=48),
  tsfeatures(wave,
             c("mean","var"), scale=FALSE, na.rm=TRUE),
  tsfeatures(wave,
             c("max_level_shift","max_var_shift"), trim=TRUE))

test = as.matrix(features)
predict = class::knn(train = X, test = test, cl = Y_lab, k = 3)

```
# new data

```{r}
new_data <- readWave('data_raw_blink_BYB_Recording_2023-04-03_10.48.27.wav')

timeSeq <- seq_len(length(new_data))/new_data@samp.rate

par(mfrow=c(1,1))
plot(timeSeq[1:95000], new_data[1:95000]@left, type = 'l', xlab = 'Time in seconds', ylab = 'Wave')
plot(timeSeq[95001:190000], new_data[95001:190000]@left, type = 'l', xlab = 'Time in seconds', ylab = 'Wave')
plot(timeSeq[190001:250000], new_data[190001:250000]@left, type = 'l', xlab = 'Time in seconds', ylab = 'Wave')
plot(timeSeq[250001:310000], new_data[250001:310000]@left, type = 'l', xlab = 'Time in seconds', ylab = 'Wave')
plot(timeSeq[310001:355000], new_data[310001:355000]@left, type = 'l', xlab = 'Time in seconds', ylab = 'Wave')
plot(timeSeq[355001:405000], new_data[355001:405000]@left, type = 'l', xlab = 'Time in seconds', ylab = 'Wave')
plot(timeSeq[405001:440000], new_data[405001:440000]@left, type = 'l', xlab = 'Time in seconds', ylab = 'Wave')
plot(timeSeq[800001:865000], new_data[800001:865000]@left, type = 'l', xlab = 'Time in seconds', ylab = 'Wave')
plot(timeSeq[865001:945000], new_data[865001:945000]@left, type = 'l', xlab = 'Time in seconds', ylab = 'Wave')
plot(timeSeq[945001:1005000], new_data[945001:1005000]@left, type = 'l', xlab = 'Time in seconds', ylab = 'Wave')
```




# creating a blink dataset
```{r}
dir_blink <- 'all blink data'
all_files_blink <- list.files(dir_blinks)
wave_file_blink <- list()
wave_left_blink <- list()
for (i in all_files_blink) {
  wave_file_blink[[i]] <- readWave(file.path(dir_blink, i))
  wave_left_blink[[i]] <- readWave(file.path(dir_blink, i))@left
}

new_blink <- list()

plot(wave_left_blink[[1]], type = 'l')
plot(wave_left_blink[[1]][60000:75000], type = 'l')

wave_left_blink[[1]][60000:75000]

plot(wave_left_blink[[2]], type = 'l')
plot(wave_left_blink[[2]][15000:30000], type = 'l')
wave_left_blink[[2]][15000:30000]
plot(wave_left_blink[[2]][30000:50000], type = 'l')
wave_left_blink[[2]][30000:50000]
plot(wave_left_blink[[2]][60000:80000], type = 'l')
wave_left_blink[[2]][60000:80000]

plot(wave_left_blink[[4]], type = 'l')
plot(wave_left_blink[[4]][10000:22000], type = 'l')
wave_left_blink[[4]][10000:22000]
plot(wave_left_blink[[4]][35000:47000], type = 'l')
wave_left_blink[[4]][35000:47000]

plot(wave_left_blink[[5]], type = 'l')
plot(wave_left_blink[[5]][8000:18000], type = 'l')
wave_left_blink[[5]][8000:18000]
plot(wave_left_blink[[5]][45900:52000], type = 'l')
wave_left_blink[[5]][45900:52000]


new_blink <- list(wave_left_blink[[1]][60000:75000],
                  wave_left_blink[[2]][15000:30000],
                  wave_left_blink[[2]][30000:50000],
                  wave_left_blink[[2]][60000:80000],
                  wave_left_blink[[4]][10000:22000],
                  wave_left_blink[[4]][35000:47000],
                  wave_left_blink[[5]][8000:18000],
                  wave_left_blink[[5]][45900:52000])

blink_lab <- rep('B', length(new_blink))

```



# mark data
```{r}
#importing
dir_mark <- 'Brain8-main/L3'
all_files_mark <- list.files(dir_mark)
wave_file_mark <- list()
wave_left_mark <- list()
for (i in all_files_mark) {
  wave_file_mark[[i]] <- readWave(file.path(dir_mark, i))
  wave_left_mark[[i]] <- readWave(file.path(dir_mark, i))@left
}

#labels
mark_lab <- list()
for (i in 1:length(all_files_mark)) {
  labels <- gsub(".wav", "", all_files_mark[i])
  mark_lab[i] <- strsplit(labels, "")
}
mark_lab <- mark_lab %>% unlist()
mark_lab[16:29] <- 'N'

#16-29
```
# splitting the mark files
```{r}
plot(wave_left_mark[[1]], type = 'l')
plot(wave_left_mark[[1]][12000:22000], type = 'l')
plot(wave_left_mark[[1]][23000:35000], type = 'l')
plot(wave_left_mark[[1]][38000:45000], type = 'l')

all_files_mark[[2]]
plot(wave_left_mark[[2]], type = 'l')
plot(wave_left_mark[[2]][10000:28000], type = 'l')
plot(wave_left_mark[[2]][27000:40000], type = 'l')
plot(wave_left_mark[[2]][40000:55000], type = 'l')

all_files_mark[[3]]
plot(wave_left_mark[[3]], type = 'l')
plot(wave_left_mark[[3]][10000:25000], type = 'l')
plot(wave_left_mark[[3]][25000:35000], type = 'l')
plot(wave_left_mark[[3]][37000:47000], type = 'l')

all_files_mark[[4]]
plot(wave_left_mark[[4]], type = 'l')
plot(wave_left_mark[[4]][6000:18000], type = 'l')
plot(wave_left_mark[[4]][23000:32000], type = 'l')
plot(wave_left_mark[[4]][35000:50000], type = 'l')

all_files_mark[[5]]
plot(wave_left_mark[[5]], type = 'l')
plot(wave_left_mark[[5]][10000:27000], type = 'l')
plot(wave_left_mark[[5]][26000:42000], type = 'l')
plot(wave_left_mark[[5]][42000:53000], type = 'l')

all_files_mark[[6]]
plot(wave_left_mark[[6]], type = 'l')
plot(wave_left_mark[[6]][0:13000], type = 'l')
plot(wave_left_mark[[6]][13000:26000], type = 'l')
plot(wave_left_mark[[6]][26000:39000], type = 'l')

all_files_mark[[7]]
plot(wave_left_mark[[7]], type = 'l')
plot(wave_left_mark[[7]][5000:17000], type = 'l')
plot(wave_left_mark[[7]][17000:30000], type = 'l')
plot(wave_left_mark[[7]][30000:43000], type = 'l')

all_files_mark[[8]]
plot(wave_left_mark[[8]], type = 'l')
plot(wave_left_mark[[8]][10000:23000], type = 'l')
plot(wave_left_mark[[8]][23000:36000], type = 'l')
plot(wave_left_mark[[8]][36000:49000], type = 'l')
plot(wave_left_mark[[8]][49000:62000], type = 'l')

all_files_mark[[9]]
plot(wave_left_mark[[9]], type = 'l')
plot(wave_left_mark[[9]][25000:38000], type = 'l')
plot(wave_left_mark[[9]][38000:51000], type = 'l')

all_files_mark[[10]]
plot(wave_left_mark[[10]], type = 'l')
plot(wave_left_mark[[10]][12000:25000], type = 'l')
plot(wave_left_mark[[10]][25000:38000], type = 'l')
plot(wave_left_mark[[10]][38000:49000], type = 'l')

all_files_mark[[11]]
plot(wave_left_mark[[11]], type = 'l')
plot(wave_left_mark[[11]][5000:17000], type = 'l')
plot(wave_left_mark[[11]][18000:28000], type = 'l')
plot(wave_left_mark[[11]][28000:42000], type = 'l')

all_files_mark[[12]]
plot(wave_left_mark[[12]], type = 'l')
plot(wave_left_mark[[12]][12000:27000], type = 'l')
plot(wave_left_mark[[12]][29000:40000], type = 'l')
plot(wave_left_mark[[12]][40000:52000], type = 'l')
```
# making mark lists
```{r}
new_left_mark <- list(
wave_left_mark[[1]][12000:22000],
wave_left_mark[[1]][23000:35000],
wave_left_mark[[1]][38000:45000],
wave_left_mark[[2]][10000:28000],
wave_left_mark[[2]][27000:40000],
wave_left_mark[[2]][40000:55000],
wave_left_mark[[3]][10000:25000],
wave_left_mark[[3]][25000:35000],
wave_left_mark[[3]][37000:47000],
wave_left_mark[[4]][6000:18000],
wave_left_mark[[4]][23000:32000],
wave_left_mark[[4]][35000:50000],
wave_left_mark[[5]][10000:27000],
wave_left_mark[[5]][26000:42000],
wave_left_mark[[5]][42000:53000],
wave_left_mark[[6]][0:13000],
wave_left_mark[[6]][26000:39000],
wave_left_mark[[7]][5000:17000],
wave_left_mark[[7]][17000:30000],
wave_left_mark[[7]][30000:43000],
wave_left_mark[[8]][10000:23000],
wave_left_mark[[8]][23000:36000],
wave_left_mark[[8]][36000:49000],
wave_left_mark[[8]][49000:62000],
wave_left_mark[[9]][25000:38000],
wave_left_mark[[9]][38000:51000],
wave_left_mark[[10]][12000:25000],
wave_left_mark[[10]][25000:38000],
wave_left_mark[[10]][38000:49000],
wave_left_mark[[11]][5000:17000],
wave_left_mark[[11]][18000:28000],
wave_left_mark[[11]][28000:42000],
wave_left_mark[[12]][12000:27000],
wave_left_mark[[12]][29000:40000],
wave_left_mark[[12]][40000:52000])

new_file_mark <- list(
wave_file_mark[[1]][12000:22000],
wave_file_mark[[1]][23000:35000],
wave_file_mark[[1]][38000:45000],
wave_file_mark[[2]][10000:28000],
wave_file_mark[[2]][27000:40000],
wave_file_mark[[2]][40000:55000],
wave_file_mark[[3]][10000:25000],
wave_file_mark[[3]][25000:35000],
wave_file_mark[[3]][37000:47000],
wave_file_mark[[4]][6000:18000],
wave_file_mark[[4]][23000:32000],
wave_file_mark[[4]][35000:50000],
wave_file_mark[[5]][10000:27000],
wave_file_mark[[5]][26000:42000],
wave_file_mark[[5]][42000:53000],
wave_file_mark[[6]][0:13000],
wave_file_mark[[6]][26000:39000],
wave_file_mark[[7]][5000:17000],
wave_file_mark[[7]][17000:30000],
wave_file_mark[[7]][30000:43000],
wave_file_mark[[8]][10000:23000],
wave_file_mark[[8]][23000:36000],
wave_file_mark[[8]][36000:49000],
wave_file_mark[[8]][49000:62000],
wave_file_mark[[9]][25000:38000],
wave_file_mark[[9]][38000:51000],
wave_file_mark[[10]][12000:25000],
wave_file_mark[[10]][25000:38000],
wave_file_mark[[10]][38000:49000],
wave_file_mark[[11]][5000:17000],
wave_file_mark[[11]][18000:28000],
wave_file_mark[[11]][28000:42000],
wave_file_mark[[12]][12000:27000],
wave_file_mark[[12]][29000:40000],
wave_file_mark[[12]][40000:52000])

wave_left_mark[[3]] <- wave_left_mark[[3]][10000:47000]
wave_left_mark[[5]] <- wave_left_mark[[5]][10000:53000]
wave_left_mark[[6]] <- wave_left_mark[[6]][0:39000]
wave_left_mark[[7]] <- wave_left_mark[[7]][5000:43000]
wave_left_mark[[8]] <- wave_left_mark[[8]][10000:62000]
wave_left_mark[[9]] <- wave_left_mark[[9]][25000:51000]
wave_left_mark[[10]] <- wave_left_mark[[10]][12000:49000]
wave_left_mark[[12]] <- wave_left_mark[[12]][12000:52000]

wave_file_mark[[3]] <- wave_file_mark[[3]][10000:47000]
wave_file_mark[[5]] <- wave_file_mark[[5]][10000:53000]
wave_file_mark[[6]] <- wave_file_mark[[6]][0:39000]
wave_file_mark[[7]] <- wave_file_mark[[7]][5000:43000]
wave_file_mark[[8]] <- wave_file_mark[[8]][10000:62000]
wave_file_mark[[9]] <- wave_file_mark[[9]][25000:51000]
wave_file_mark[[10]] <- wave_file_mark[[10]][12000:49000]
wave_file_mark[[12]] <- wave_file_mark[[12]][12000:52000]

```


# testing on mark data - amp
```{r}
#using features, one-step classification
Y_list = new_mark
Y_lab = mark_lab

Y_features <- cbind(
  tsfeatures(Y_list,
             c("acf_features","entropy","lumpiness",
               "flat_spots","crossing_points")),
  tsfeatures(Y_list, "max_kl_shift", width=48),
  tsfeatures(Y_list,
             c("mean","var"), scale=FALSE, na.rm=TRUE),
  tsfeatures(Y_list,
             c("max_level_shift","max_var_shift"), trim=TRUE))

X = as.matrix(Y_features)
y = Y_lab 

cvK = 5  # number of CV folds
cv_50acc5_knn = cv_50acc5_svm = cv_50acc5_rf = c()
cv_acc_knn = cv_acc_svm = cv_acc_rf = c()
for (i in 1:50) {
  cvSets = cvTools::cvFolds(nrow(X), cvK)  # permute all the data, into 5 folds
  cv_acc_knn = cv_acc_svm = cv_acc_rf = c()
  for (j in 1:cvK) {
    test_id = cvSets$subsets[cvSets$which == j]
    X_test = X[test_id, ]
    X_train = X[-test_id, ]
    y_test = y[test_id]
    y_train = y[-test_id]
    
    ## KNN
    fit5 = class::knn(train = X_train, test = X_test, cl = y_train, k = 5)
    cv_acc_knn[j] = mean(fit5 == y_test)
    
    ## SVM
    svm_res <- e1071::svm(x = X_train, y = as.factor(y_train))
    fit <- predict(svm_res, X_test)
    cv_acc_svm[j] = mean(fit == y_test)

    ## RandomForest
    rf_res <- randomForest::randomForest(x = X_train, y = as.factor(y_train))
    fit <- predict(rf_res, X_test)
    cv_acc_rf[j] = mean(fit == y_test)
  }
  cv_50acc5_knn <- append(cv_50acc5_knn, mean(cv_acc_knn))
  cv_50acc5_svm <- append(cv_50acc5_svm, mean(cv_acc_svm))
  cv_50acc5_rf <- append(cv_50acc5_rf, mean(cv_acc_rf))
}

boxplot(cv_50acc5_knn, cv_50acc5_svm, cv_50acc5_rf, horizontal = TRUE, names = c('KNN', 'SVM', 'RF'), main = 'Evaluating classifier performance', xlab = '% Accuracy using 5-fold cross validation')



#prediction
predict_old = function(wave) {
  features <- cbind(
    tsfeatures(wave,
               c("acf_features","entropy","lumpiness",
                 "flat_spots","crossing_points")),
    tsfeatures(wave, "max_kl_shift", width=48),
    tsfeatures(wave,
               c("mean","var"), scale=FALSE, na.rm=TRUE),
    tsfeatures(wave,
               c("max_level_shift","max_var_shift"), trim=TRUE))
  
  test = as.matrix(features)
  
  return (class::knn(train = X, test = test, cl = Y_lab, k = 3))
}

predict(readWave('Brain8-main/Record/R2.wav')@left) %>% as.character %>% print


#event vs non-event
#mark_lab[mark_lab == 'L' | mark_lab == 'R' | mark_lab == 'B'] <- 'E'
#mark_lab

event_amp = function(Y, 
thresholdEvents) {
  testStat <- abs(Y) %>% max
return (ifelse(testStat > thresholdEvents, 'T', 'F'))
}

predict_amp = function(wave_file, events, 
                                window_size = wave_file@samp.rate,
                                increment = window_size/10)
{
  Y = wave_file@left
  xtime = seq_len(length(wave_file@left))/wave_file@samp.rate
  predicted_labels_amp = c()
  predicted_times_amp = c()
  lower_interval = 1
  max_time = max(xtime)*window_size
  amp_values <- c()
  counter = 0
  
  while(max_time > lower_interval + window_size)
  {
    is_event = 'F'
    upper_interval = lower_interval + window_size
    interval = Y[lower_interval:upper_interval]
    amp_values <- append(amp_values, abs(interval) %>% max)
    is_event = event_amp(Y = interval, thresholdEvents = events)
    if (is_event == 'T') { 
      if (counter < 7) {
        counter = counter + 1
      } else {
        predicted_amp = predict(interval)
        predicted_labels_amp = c(predicted_labels_amp,
                                 as.character(predicted_amp))
        predicted_times_amp = c(predicted_times_amp,
                                lower_interval/10000)
        counter = 0
      }
    }
    lower_interval = lower_interval + increment 
  }
  return (list(predicted_labels_amp = predicted_labels_amp,
               predicted_times_amp = predicted_times_amp,
               amp_values = amp_values))
}

predict_amp(wave_file_length3[[1]], 2200)$predicted_labels_amp
plot(seq_len(length(wave_file_length3[[1]]))/wave_file_length3[[1]]@samp.rate, wave_file_length3[[1]]@left, type = 'l')
abline(v = predict_amp(wave_file_length3[[1]], 2200)$predicted_times_amp)

plot(predict_amp(wave_file_length3[[10]], 80000)$amp_values, type = 'l')
abline(v = predict_amp(wave_file_length3[[10]], 2000)$predicted_times_amp*10)


#streaming condition
stream_old = function(wave_file, 
                  window_size = wave_file@samp.rate,
                  increment = window_size/10)
{
  Y = wave_file@left
  xtime = seq_len(length(wave_file@left))/wave_file@samp.rate 
  predicted_labels = c()
  timestamps = c()
  lower_interval = 1
  max_time = max(xtime)*window_size
  
  while(max_time > lower_interval + window_size)
  {
    upper_interval = lower_interval + window_size
    interval = Y[lower_interval:upper_interval]
    predicted_labels = c(predicted_labels, predict(Y))
    timestamps = c(timestamps, lower_interval/10000)
    lower_interval = lower_interval + increment 
  }
  return (list(predicted_labels = predicted_labels,
timestamps = timestamps))
}

plot(readWave('Brain8-main/Record/L.wav')@left[10000:30000], type = 'l')

readWave('Brain8-main/Record/L.wav')@left[10000:30000] %>% predict %>% print

amps <- rep(NA, length(new_left_mark))

for (i in 1:length(new_left_mark)){
  amps[i] <- abs(new_left_mark[[i]]) %>% max
}

mean(c(amps[1:15], amps[30:35]))

for (i in 1:length(wave_file_mark)) {
  plot(predict_amp(wave_file_mark[[i]], 80000)$amp_values, type = 'l')
  abline(v = predict_amp(wave_file_mark[[i]], (1200+mean(c(amps[1:15], amps[30:35])))/2)$predicted_times_amp*10)
  predict_amp(wave_file_mark[[i]], (1200+mean(c(amps[1:15], amps[30:35])))/2)$predicted_labels_amp %>% print
}

  plot(predict_amp(wave_file_mark[[1]], 80000)$amp_values, type = 'l')
  abline(v = predict_amp(wave_file_mark[[1]], (1200+mean(c(amps[1:15], amps[30:35])))/2)$predicted_times_amp*10)
predict_amp(wave_file_mark[[1]], (1200+mean(c(amps[1:15], amps[30:35])))/2)$predicted_labels_amp %>% print

plot(predict_amp(wave_file_mark[[1]], 80000)$amp_values, type = 'l')
plot(wave_file_mark[[12]]@left, type = 'l')
abline(v = predict_amp(wave_file_mark[[12]], 1200)$predicted_times_amp*10)
```

# testing on mark data - sd
```{r}
#classifying events
event_sd = function(Y, 
thresholdEvents) {
  testStat <- sd(Y)
return (ifelse(testStat > thresholdEvents, 'T', 'F'))
}

#prediction
Y_list = event_list_mark %>% append(., event_list_gleb)
Y_lab = event_lab_mark %>% append(., event_lab_gleb)


Y_features <- cbind(
  tsfeatures(Y_list,
             c("acf_features","entropy","lumpiness",
               "flat_spots","crossing_points")),
  tsfeatures(Y_list, "max_kl_shift", width=48),
  tsfeatures(Y_list,
             c("mean","var"), scale=FALSE, na.rm=TRUE),
  tsfeatures(Y_list,
             c("max_level_shift","max_var_shift"), trim=TRUE))

X = as.matrix(Y_features)
y = Y_lab 

rf <- randomForest::randomForest(x = X, y = as.factor(y))

predict_movement = function(wave) {
  features <- cbind(
    tsfeatures(wave,
               c("acf_features","entropy","lumpiness",
                 "flat_spots","crossing_points")),
    tsfeatures(wave, "max_kl_shift", width=48),
    tsfeatures(wave,
               c("mean","var"), scale=FALSE, na.rm=TRUE),
    tsfeatures(wave,
               c("max_level_shift","max_var_shift"), trim=TRUE))
  
  test = as.matrix(features)

  return (predict(rf, test) %>% as.character)
}

#main function
predict_sd = function(wave_file, events, 
                                window_size = wave_file@samp.rate,
                                increment = window_size/10)
{
  Y = wave_file@left
  xtime = seq_len(length(wave_file@left))/wave_file@samp.rate 
  predicted_labels_sd = c()
  predicted_times_sd = c()
  lower_interval = 1
  max_time = max(xtime)*(window_size)
  sd_values <- c()
  last_sd = 0
  in_movement = 'F'
  past_peak = 'F'
  
  while(max_time > lower_interval + window_size)
  {
    upper_interval = lower_interval + window_size
    interval = Y[lower_interval:upper_interval]
    in_movement = event_sd(Y = interval, thresholdEvents = events)
    if (in_movement == 'T') {
      if (sd(interval) < last_sd & past_peak == 'F') {
        predicted_sd = predict_movement(interval)
        predicted_labels_sd = c(predicted_labels_sd, predicted_sd)
        predicted_times_sd = c(predicted_times_sd, lower_interval/10000)
        past_peak = 'T'

      } 
      }
       else {
        past_peak = 'F'     
  }
    #print(c(past_peak, in_movement, in_movement))
    sd_values <- append(sd_values, sd(interval))
    last_sd = sd(interval)
    lower_interval = lower_interval + increment 
  }
  return (list(predicted_labels_sd = predicted_labels_sd,
               predicted_times_sd = predicted_times_sd,
               sd_values = sd_values))
}

for (i in 1:length(wave_file_mark)) {
  plot(predict_sd(wave_file_mark[[i]], 80000)$sd_values, type = 'l')
  #print(predict_sd(wave_file_mark[[i]], 80000)$sd_values)
  abline(v = predict_sd(wave_file_mark[[i]], 600)$predicted_times_sd*10)
  predict_sd(wave_file_mark[[i]],600) $predicted_labels_sd %>% print
}



  plot(predict_sd(wave_file_mark[[4]], 600)$sd_values, type = 'l')
  print(predict_sd(wave_file_mark[[4]], 600)$sd_values)
  abline(v = predict_sd(wave_file_mark[[4]], 600)$predicted_times_sd*10)
  
  
#polished testing loop
for (i in 1:length(wave_file_mark)) {
  results <- predict_sd(wave_file_mark[[i]], 500)
  par(mfrow = c(2,1))
  
  #sd plot
  plot(results[[3]], type = 'l')
  abline(v = results[[2]]*10)  
  
  #wave plot
  plot(seq_len(length(wave_file_mark[[i]]))/wave_file_mark[[i]]@samp.rate, wave_left_mark[[i]], type = 'l')
  if (!is.null(results[[2]])) {
    for (i in 1:length(results[[2]])) {
    polygon(x=c(results[[2]][i],(results[[2]][i]+1),(results[[2]][i]+1),results[[2]][i]),y=c(-10000,-10000, 10000, 10000),col=rgb(255, 0, 0, max = 255, alpha = 50), border = NA)
    }
  }
  
  #prediction
  results[[1]] %>% print
  
    print(results[[3]])
}
  
predict_sd(wave_file_mark[[3]], 600)

wave_file = wave_file_mark[[3]]
events = 600
                                window_size = wave_file_mark[[3]]@samp.rate
                                increment = window_size/10
  Y = wave_file@left
  xtime = seq_len(length(wave_file@left))/wave_file@samp.rate 
  predicted_labels_sd = c()
  predicted_times_sd = c()
  lower_interval = 1
  max_time = max(xtime)*window_size
  sd_values <- c()
  last_sd = 0
  in_movement = 'F'
  past_peak = 'F'
  
  while(max_time > lower_interval + window_size)
  {
    upper_interval = lower_interval + window_size
    interval = Y[lower_interval:upper_interval]
    in_movement = event_sd(Y = interval, thresholdEvents = events)
    if (in_movement == 'T') {
      if (sd(interval) < last_sd & past_peak == 'F') {
        predicted_sd = predict(interval)
        predicted_labels_sd = c(predicted_labels_sd, predicted_sd)
        predicted_times_sd = c(predicted_times_sd, lower_interval/10000)
        past_peak = 'T'

      } 
      }
       else {
        past_peak = 'F'     
  }
    #print(c(past_peak, in_movement, in_movement))
    print(c(in_movement, lower_interval))
    sd_values <- append(sd_values, sd(interval))
    last_sd = sd(interval)
    lower_interval = lower_interval + increment 
  }

    if (event_sd(wave_file_mark[[3]]@left[18001:28001], 600) == 'T') {
      if (sd(interval) < last_sd & past_peak == 'F') {
        predicted_sd = predict(interval)
        predicted_labels_sd = c(predicted_labels_sd, predicted_sd)
        predicted_times_sd = c(predicted_times_sd, lower_interval/10000)
        past_peak = 'T'

      } 
      }
       else {
        past_peak = 'F'     
  }
  
  plot(wave_file_mark[[3]]@left, type = 'l')
```
# gleb data
```{r}
dir_gleb <- 'Brain8-main/gleb'
all_files_gleb <- list.files(dir_gleb)
wave_file_gleb <- list()
wave_left_gleb <- list()
for (i in all_files_gleb) {
  wave_file_gleb[[i]] <- readWave(file.path(dir_gleb, i))
  wave_left_gleb[[i]] <- readWave(file.path(dir_gleb, i))@left
}

#labels
gleb_lab <- list()
for (i in 1:length(all_files_gleb)) {
  labels <- gsub(".wav", "", all_files_gleb[i])
  gleb_lab[i] <- strsplit(labels, "")
}
gleb_lab <- gleb_lab %>% unlist()
```


# testing on gleb data - sd
```{r}
for (i in 1:length(wave_file_gleb)) {
  results <- predict_sd(wave_file_gleb[[i]], 600)
  par(mfrow = c(2,1))
  
  #sd plot
  plot(results[[3]], type = 'l')
  abline(v = results[[2]]*10)  
  
  #wave plot
  plot(seq_len(length(wave_file_gleb[[i]]))/wave_file_gleb[[i]]@samp.rate, wave_left_gleb[[i]], type = 'l')
  if (!is.null(results[[2]])) {
    for (i in 1:length(results[[2]])) {
    polygon(x=c(results[[2]][i],(results[[2]][i]+1),(results[[2]][i]+1),results[[2]][i]),y=c(-10000,-10000, 10000, 10000),col=rgb(255, 0, 0, max = 255, alpha = 50), border = NA)
    }
  }
  
  #prediction
  results[[1]] %>% print
  
    print(results[[3]])
}
```
# testing on sample data
```{r}
stream = function(file, labels) {
  for (i in 1:length(file)) {
    results <- predict_sd(file[[i]], 500)
    par(mfrow = c(2,1))
    
    #sd plot
    plot(results[[3]], type = 'l', xlab = 'Window number', ylab = 'Standard deviation', main = gsub('[^LRBN]', '', labels[i]))
    abline(v = results[[2]]*10)  
    
    #wave plot
    plot(seq_len(length(file[[i]]))/file[[i]]@samp.rate, file[[i]]@left, type = 'l', xlab = 'Time (seconds)', ylab = 'Frequency')
    if (!is.null(results[[2]])) {
      for (i in 1:length(results[[2]])) {
      polygon(x=c(results[[2]][i],(results[[2]][i]+1),(results[[2]][i]+1),results[[2]][i]),y=c(-10000,-10000, 10000, 10000),col=rgb(255, 0, 0, max = 255, alpha = 50), border = NA)
      }
    }
    
    #prediction
    results[[1]] %>% print
    
      print(results[[3]])
  }
}

stream(wave_file_length3)
```
# evaluation
```{r}
evaluate = function(file, labels, threshold) {
  total_tp = 0
  total_tn = 0
  total_fp = 0
  total_fn = 0
  correct = 0
  keep_labels = c('L', 'R', 'B')
  for (i in 1:length(file)) {
    results <- predict_sd(file[[i]], threshold)

    num_pred_events = which(results[[1]] != 'N') %>% length
    num_true_events <- which(gsub('[^LRBN]', '', labels[i]) %>% strsplit(., "") %>% unlist != 'N') %>% length
    num_windows = length(results[[3]])
    
    if (num_pred_events > num_true_events) {
      fp = num_pred_events - num_true_events
      tp = num_true_events
      fn = 0
      tn = num_windows - num_pred_events
    }
    else if (num_true_events > num_pred_events) {
      fn = num_true_events - num_pred_events
      tp = num_pred_events
      fp = 0
      tn = num_windows - num_true_events
    }
    else if (num_true_events == num_pred_events) {
      tp = num_true_events
      tn = num_windows - tp
      fn = 0
      fp = 0
    }
    
      total_tp = total_tp + tp
      total_tn = total_tn + tn
      total_fp = total_fp + fp
      total_fn = total_fn + fn
      
    #percentage of .wav files that are 100% correct
    abs_acc = num_pred_events/num_true_events
    if (is.na(abs_acc)) {
      if (num_pred_events == 0) {
        correct = correct + 1
      }
    }
    else if (abs_acc == 1) {
      correct = correct + 1
    }
  }
  return (list(overall_acc =  (total_tp + total_tn) / (total_tp + total_tn + total_fp + total_fn),
          balanced_acc = (total_tp / (total_tp + total_fn) + total_tn / (total_fp + total_tn)) / 2,
          precision = total_tp / (total_tp + total_fp),
          sensitivity = total_tp / (total_tp + total_fn),
          specificity = total_tn / (total_tn + total_fp)
  ))
}

megafile <- list(wave_file_mark, wave_file_gleb, wave_file_length3, wave_file_length8, wave_file_long)
megafile_lab <- list(all_files_mark, all_files_gleb, all_files_length3, all_files_length8, all_files_long)

evaluation_table = c()
for (i in 1:length(megafile)) {
  x<- evaluate(megafile[[i]], megafile_lab[[i]], 500)
  evaluation_table = cbind(evaluation_table, x)
}
  
evaluation_table_0.8 <- evaluation_table
rownames(evaluation_table_0.8) <- c('Overall accuracy', 'Balanced accuracy', 'Precision', 'Sensitivity', 'Specificity')
colnames(evaluation_table_0.8) <- c('Mark', 'Gleb', 'Zoe (short)', 'Zoe (medium)', 'Zoe(long)')

boxplot(evaluation_table_0.8[1,] %>% unlist,
        evaluation_table_0.8[2,] %>% unlist,
        evaluation_table_0.8[3,] %>% unlist,
        evaluation_table_0.8[4,] %>% unlist,
        evaluation_table_0.8[5,] %>% unlist, names = rownames(evaluation_table_0.8), main = 'Performance of event detection classifier when window size is 20% smaller')

```
# snapshotting events for training
```{r}
snapshot = function(wave_file, events, 
                                window_size = wave_file@samp.rate,
                                increment = window_size/10)
{
  Y = wave_file@left
  xtime = seq_len(length(wave_file@left))/wave_file@samp.rate 
  event_list = list()
  lower_interval = 1
  max_time = max(xtime)*(window_size)
  sd_values <- c()
  last_sd = 0
  in_movement = 'F'
  past_peak = 'F'
  
  while(max_time > lower_interval + window_size)
  {
    upper_interval = lower_interval + window_size
    interval = Y[lower_interval:upper_interval]
    in_movement = event_sd(Y = interval, thresholdEvents = events)
    if (in_movement == 'T') {
      if (sd(interval) < last_sd & past_peak == 'F') {
        event_list = append(event_list, list(interval))
        past_peak = 'T'
      } 
      }
       else {
        past_peak = 'F'     
  }
    #print(c(past_peak, in_movement, in_movement))
    sd_values <- append(sd_values, sd(interval))
    last_sd = sd(interval)
    lower_interval = lower_interval + increment 
  }
  return (event_list)
}
```
# using the detection function to isolate events for training
```{r}
# mark
event_list_mark = list()
for (i in 1:length(wave_file_mark)) {
  event_list_mark <- append(event_list_mark, snapshot(wave_file_mark[[i]], 600))
}

#for (i in 1:length(event_list_mark)) {
#  plot(event_list_mark[[i]], type = 'l')
#}

event_lab_mark = c('B', 'B', 'B', 'L', 'B', 'L', 'L', 'L', 'L', 'L', 'L', 'R', 'L', 'B', 'B')

#gleb
event_list_gleb = list()
for (i in 1:length(wave_file_gleb)) {
  event_list_gleb <- append(event_list_gleb, snapshot(wave_file_gleb[[i]], 600))
}
event_list_gleb = event_list_gleb[-c(15, 19, 23)]

#for (i in 1:length(event_list_gleb)) {
#  plot(event_list_gleb[[i]], type = 'l')
#}

event_lab_gleb <- c('B', 'B', 'B', 'B', 'B', 'L', 'B', 'R', 'B', 'L', 'L', 'B', 'L', 'L', 'L', 'L', 'L', 'L', 'L', 'R', 'B', 'L', 'R', 'B', 'L', 'L', 'R', 'L', 'R', 'B', 'B', 'R', 'B', 'B', 'L', 'R', 'B', 'R', 'R', 'R', 'R', 'R', 'R', 'R', 'R')

#sample
event_list_length3 = list()
for (i in 1:length(wave_file_length3)) {
  event_list_length3 <- append(event_list_length3, snapshot(wave_file_length3[[i]], 600))
}

#for (i in 1:length(event_list_length3)) {
#  plot(event_list_length3[[i]], type = 'l')
#}

event_lab_length3 <- readRDS('wave_label_short_results.rds') %>% unlist

event_list_length8 = list()
for (i in 1:length(wave_file_length8)) {
  event_list_length8 <- append(event_list_length8, snapshot(wave_file_length8[[i]], 600))
}

#for (i in 1:length(event_list_length8)) {
#  plot(event_list_length8[[i]], type = 'l')
#}

event_lab_length8 = c('R', 'R', 'R', 'L', 'R', 'R', 'R', 'L', 'L', 'R', 'R', 'L', 'R', 'R', 'R', 'L', 'R', 'R', 'R', 'R', 'L', 'R', 'R')

event_list_long = list()
for (i in 1:length(wave_file_long)) {
  event_list_long <- append(event_list_long, snapshot(wave_file_long[[i]], 600))
}

#for (i in 1:length(event_list_long)) {
#  plot(event_list_long[[i]], type = 'l')
#}

event_lab_long = c('L', 'L', 'R', 'L', 'R', 'R', 'R', 'R', 'R', 'R', 'L', 'R', 'L', 'R', 'R', 'R', 'R', 'L', 'R', 'R', 'L', 'L', 'R', 'R', 'R', 'L')

stream(wave_file_long)
```
# calibration test
```{r}
#function reads in a list of events
calibrate = function(wave_list) {
  sds <- c()
  for (i in 1:length(wave_list[[i]])) {
    sds = sds + sd(wave_list[[i]])
  }
  return (sds %>% mean)
}

event_list_gleb %>% 
```




